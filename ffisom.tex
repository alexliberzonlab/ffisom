\documentclass[12pt]{article}

\usepackage[margin = 1in]{geometry}
\usepackage{graphicx}              
\usepackage{amsmath}               
\usepackage{amsfonts}              
\usepackage{amsthm}                
\usepackage{amssymb}
\usepackage{mathrsfs}
\usepackage{url}
\usepackage{subfig}
\usepackage{xfrac}
\usepackage[sectionbib]{chapterbib}
\usepackage{hyperref}
\usepackage{tikz}
\usetikzlibrary{positioning}
\usetikzlibrary{calc}
\usepackage{algorithmic}
\usepackage{enumerate}

\hypersetup{
	unicode=true,
	colorlinks=true,
	citecolor=black,
	filecolor=black,
	linkcolor=black,
	urlcolor=black,
	pdfstartview={FitH},
}

% theorem environments
\theoremstyle{plain}
\newtheorem{theorem}{Theorem}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{proposition}[theorem]{Proposition}
\theoremstyle{definition}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{example}[theorem]{Example}
\newtheorem*{remark}{Remark}
\newtheorem*{note}{Note}


\renewcommand{\algorithmicrequire}{\textbf{Input:}}
\renewcommand{\algorithmicensure}{\textbf{Output:}}
\algsetup{linenodelimiter=.}

\newcommand{\wrt}{\vdash} 
\newcommand{\ang}[1]{\langle#1\rangle}
\newcommand{\abs}[1]{\left\vert#1\right\vert}
\newcommand{\dual}[1]{\overline{#1}}
\newcommand{\mapsfrom}{\ensuremath{\reflectbox{$\mapsto$}}}
\newcommand{\tildO}{\tilde{O}}
% roman numerals
\newcommand{\romnum}[1]{\romannumeral #1}
\newcommand{\Romnum}[1]{\uppercase\expandafter{\romannumeral #1}}

\newcommand{\todo}[1]{\textcolor{red}{TODO: #1}}
\newcommand{\comment}[2][Note]{\textcolor{green}{(#1): #2}}

\DeclareMathOperator{\fieldchar}{char} % characteristic of a field
\DeclareMathOperator{\ringofend}{End} % endomorphism ring
\DeclareMathOperator{\trace}{Tr} % finite field trace
\DeclareMathOperator{\gal}{Gal} % Galois group
\DeclareMathOperator{\order}{ord} % order of an element
\DeclareMathOperator{\lcm}{lcm} % least common multiple
\DeclareMathOperator{\divisor}{div} % divisor on a curve
\DeclareMathOperator{\supp}{supp} % support of a divisor
\DeclareMathOperator{\norm}{N} % norm
\DeclareMathOperator{\Res}{Res}
\DeclareMathOperator{\Aut}{Aut}
\DeclareMathOperator{\minpoly}{minpoly}

\def\Q{\ensuremath{\mathbb{Q}}}
\def\N{\ensuremath{\mathbb{N}}}
\def\R{\ensuremath{\mathbb{R}}}
\def\Z{\ensuremath{\mathbb{Z}}}
\def\F{\ensuremath{\mathbb{F}}}
\def\H{\ensuremath{\mathbb{H}}}
\def\K{\ensuremath{\mathbb{K}}}
\def\L{\ensuremath{\mathbb{L}}}
\def\A{\ensuremath{\mathbb{A}}}
\def\B{\ensuremath{\mathbb{B}}}
\def\MM{\ensuremath{\mathsf{M}}}
\def\MC{\ensuremath{\mathsf{C}}}
\def\II{\ensuremath{\mathsf{I}}}
\def\QQ{\ensuremath{\mathsf{Q}}}
\def\CC{\ensuremath{\mathsf{C}}}
\def\RR{\ensuremath{\mathsf{R}}}
\def\AA{\ensuremath{\mathsf{A}}}
\def\va{\ensuremath{\mathsf{a}}}
\def\vy{\ensuremath{\mathsf{y}}}
\def\vu{\ensuremath{\mathsf{u}}}
\def\vb{\ensuremath{\mathsf{b}}}
\def\vc{\ensuremath{\mathsf{c}}}
\def\mul{\ensuremath{\mathsf{mul}}}
\def\rem{\ensuremath{\mathsf{rem}}}
\def\cat{\ensuremath{\mathsf{cat}}}
\def\coeff{\ensuremath{\mathsf{coefficient}}}
\def\mulmod{\ensuremath{\mathsf{mulmod}}}
\def\rev{\ensuremath{\mathsf{rev}}}
\def\x{\ensuremath{\mathbf{x}}}
\def\uu{\ensuremath{\mathbf{U}}}
\def\bb{\ensuremath{\mathbf{B}}}
\def\bxi{\boldsymbol{\xi}}
\def\bupsilon{\boldsymbol{\upsilon}}
\def\bzeta{\boldsymbol{\zeta}}
\def\blambda{\boldsymbol{\lambda}}


% allow algorithms to split over multiple pages
\makeatletter
\newcounter{algorithm}
\setcounter{algorithm}{0}
\renewcommand{\thealgorithm}{\arabic{algorithm}}
\def\algorithm{\@ifnextchar[{\@algorithma}{\@algorithmb}}
\def\@algorithma[#1]{%
	\refstepcounter{algorithm}
	\trivlist
	\leftmargin\z@
	\itemindent\z@
	\labelsep\z@
	\item[\parbox{\columnwidth}{%
		\hrule
		\hrule
		\noindent\strut\textbf{Algorithm \thealgorithm} #1
		\hrule
	}]\hfil\vskip0em%
}
\def\@algorithmb{\@algorithma[]}
\def\endalgorithm{\hfil\vskip-1em\hrule\endtrivlist}
\makeatother


\title{Computing isomorphisms and embeddings of finite fields}
\author{Ludovic Brieulle, Luca De Feo, Javad Doliskani,\\ Jean-Pierre
  Flori and \'Eric Schost}


\begin{document}

\maketitle
\begin{abstract}
  Let $\F_q$ be a finite field.  The finite field embedding problem
  asks, given two irreducible polynomials $f,g$ in $\F_q[X]$ with
  $\deg f$ dividing $\deg g$, to compute an explicit description of a
  field embedding of $\F_q[X]/f$ into $\F_q[X]/g$. When $\deg f = \deg
  g$, this is also known as the isomorphism problem.
  
  We review classical algorithms for the two problems, and compare
  their asymptotic complexities. We also propose new improvements and
  generalizations to the algorithms, implement them, and compare them
  with the state of the art.
\end{abstract}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section*{Notations}

\def\poster{\textbf{Poster}}
\def\rains{\textbf{Rains}}
\def\kummer{\textbf{Kummer}}
\def\cons{\textbf{consensual}}
\def\prop{\textbf{proposed}}

This section is for internal reference only: erase after the paper has
stabilized.


Diagram from the poster:

\begin{tikzpicture}[node distance=8em]
  \node(Fq){$\F_q$};
  \node(Fqf)[above left of=Fq]{$k=\F_q[X]/(f)$};
  \node(Fqg)[above right of=Fqf]{$K=\F_q[Y]/(g)$};
  \draw[]
  (Fq) edge (Fqf)
  (Fq) edge (Fqg)
  (Fqf) edge[left,auto] node{$\varphi$} (Fqg);
\end{tikzpicture}

\begin{itemize}
\item Base field: 
  \begin{itemize}
  \item \cons: $\F_q$,
  \item \kummer: $E=\F_q$
  \item \prop: $\F_q$ is the base field, no alias for it. Where
    needed, we make clear that $q$ is prime. We avoid using $p$
    anywhere.
  \end{itemize}
\item Irreducible polynomials:
  \begin{itemize}
  \item \poster: $f$ (smallest), $g$ (largest),
  \item \kummer: $f$ degree $r$ polynomial defining the extension, $g$
    factor of the cyclotomic polynomial,
  \item \prop: $f$ and $g$ are reserved for the defining polynomials of the
    field extensions.
  \end{itemize}
\item Fields:
  \begin{itemize}
  \item \poster: $k$ (smallest), $K$ (largest),
  \item \kummer: $F,F_1,F_2$ 
  \item \rains: $k_1,k_2$, 
  \item \rains: $K,L$ number fields
  \item \prop: ??
  \end{itemize}
\item Polynomials: 
  \begin{itemize}
  \item \cons{} variables are upper-cased: $X,Y,\dots$
  \item \kummer: in secs. 2.1.3 and 2.1.4 variables become lower-cased,
    $f,f_i,g,g_1,g_2,h,v$ are used for generic polynomials
  \item \prop: Polynomial variables are all upper-case: $X,Y,Z$. $f$ and $g$ are reserved.
  \end{itemize}
\item Field extensions:
  \begin{itemize}
  \item \poster, \rains: $\F_q[X]/(f)$
  \item \textbf{intro}: $\F_q[X]/f$
  \item \kummer: $\F_q[X]/f(X)$ but $\F_q[X]/\ang{X^r-c}$
  \item \prop: ??
  \end{itemize}
\item Degrees:
  \begin{itemize}
  \item \poster, \prop: $m=\deg f$ (smallest extension), $n=\deg g$ (largest extension),
  \item \kummer: $r = [F:\F_q]$,
  \item \rains: $n=\deg f=\deg g$,
  \end{itemize}
\item Other integers and degrees:
  \begin{itemize}
  \item \poster: $s$ (prime) such that $\mu_s$ generates $k$,
  \item \poster: $e$ exponent such that $\alpha\mapsto\beta^e$
    (inconsistent with ``Generators'' below)
  \item \poster: $o$ degree of auxiliary extension (quite bad visually)
  \item \kummer: $j,\ell$ some exponents sending generators over other generators
  \item \kummer: $s,u,t$ order of $p \mod r$ and related integers
  \item \rains: $m$ integer (often prime) such that $\mu_m$ generates $k_1$ 
  \item \rains: $\ell$ extension degree (e.g., $q=p^\ell$)
  \item \rains: $k$ extension degree,
  \item \rains: $a,b$ elements of $(\Z/m\Z)^\times$
  \item \prop: ??
  \end{itemize}
\item Embedding/isomorphism:
  \begin{itemize}
  \item \poster: $\varphi$ (clashes with Euler function),
  \item \kummer: $\varphi_1,\varphi_2,\psi$,
  \item \rains: $\varphi$, $\varphi_e$
  \item \prop: ??
  \end{itemize}
\item Generators:
  \begin{itemize}
  \item \poster, \prop: $\F_q[\alpha]=k$ (smallest), $\beta = \varphi(\alpha)$ (largest), 
  \item \kummer: $c,c_i$ generators of Teichm\"uller groups $T_E$,
  \item \kummer: $\alpha_1,\alpha_2\gamma$ generator of extension ring $F[\zeta]$,
  \item \kummer: $x,z$ residue classes of $X,Z$
  \item \rains: $\alpha,\beta$
  \end{itemize}
\item Other field elements:
  \begin{itemize}
  \item \poster: $\gamma, \delta$
  \item \poster: $a=\alpha^m$, $b=\beta^m$ in Lenstra's algorithm
  \item \kummer: $b=(\alpha_1/\alpha_2)^r$ generators of extension ring
  \item \kummer: $c=(\eta_a/\eta_b)$, same role as $b$ above, but in different section
  \item \kummer: $\theta_a$ solution to Hilbert 90
  \item \kummer: $\beta_a,\beta_b,\gamma_a,\gamma_b$ byproducts of Hilbert 90 proof
  \item \kummer: $\eta,\eta_a=\theta_a^r,\eta_b=\theta_b^r$ non $r$-adic residues
  \item \kummer: $\xi_i,\delta_i$ intermediary computations
  \item \kummer: $\beta_i,\xi_i,\zeta_i$ intermediary computations
  \item \rains: $j,j_E$ curve invariant
  \item \rains: $A,B,D$ curve coefficients
  \item \prop: Elements of \emph{small} fields (e.g. $\F_q,
    \F_q[\zeta]$ are represented by roman letters. Elements of
    \emph{large fields} (e.g. $\F_{q^m},\F_{q^n}$ are represented by
    greek letters.
  \end{itemize}
\item Roots of unity and related elements:
  \begin{itemize}
  \item \poster, \rains, \prop: $\mu_m$ group of $m$-th roots, $\zeta$ a root,
  \item \poster, \rains: $\eta(\alpha)$, $\eta(\zeta)$ (gaussian) periods,
  \item \rains: $\eta_a(P)$ elliptic period
  \item \kummer: $\Phi_r$ cyclotomic polynomial
  \end{itemize}
\item Galois theory:
  \begin{itemize}
  \item \poster, \prop: $\gal(K/k)$ Galois group, $\sigma\in\gal$ (preferred
    to $q$ to express frobenius)
  \item \kummer: $\Delta=\Aut(S/R)$ Automorphism group of rings,
  \item \kummer: $\gal(K/k)$ Galois group, $\sigma\in\gal$ (but
    prefers using $p$ as exponent in formulas)
  \item \kummer: $T_{K/k}$ trace
  \item \rains: $\Aut(E)$ automorphism group of a curve
  \item \prop: use $\trace$ for trace
  \end{itemize}
\item Modular integers
  \begin{itemize}
  \item \poster: $\Z/s$ and $(\Z/s)^\ast$,
  \item \kummer: $\Z/r\Z$
  \item \rains: $\Z/m\Z$ and $(\Z/m\Z)^\times$,
  \item \prop: ??
  \end{itemize}
\end{itemize}

Note: abstract and intro generally agree with \poster{} notation.



\section{Introduction}

Let $q$ be a prime power and let $\F_q$ be a field with $q$
elements. Let $f$ and $g$ be irreducible polynomials in $\F_q[X]$,
with $\deg f$ dividing $\deg g$. Define $k=\F_q[X]/f$ and
$K=\F_q[X]/g$,
then there is an embedding $\varphi:k\hookrightarrow
K$, unique up to $\F_q$-automorphisms of $k$. The goal of this paper
is to describe algorithms to efficiently represent and evaluate one
such embedding.

\todo{Motivation, previous work.}

All the algorithms we are aware of, split the embedding problem in two
sub-problems:
\begin{enumerate}
\item Determine elements $\alpha\in k$ and $\beta\in K$ such that
  $k=\F_q[\alpha]$, and such that there exists an
  embedding $\varphi$ mapping $\alpha\mapsto\beta$. We refer to this
  problem as the \emph{Embedding description}.
  It is easily seen that $\alpha$ and $\beta$ describe an embedding
  if and only if they share the same minimal polynomial.
\item Given elements $\alpha$ and $\beta$ as above, given $\gamma\in
  k$ and $\delta\in K$, solve the following problems:
  \begin{itemize}
  \item Compute $\varphi(\gamma)\in K$.
  \item Test if $\delta\in\varphi(k)$.
  \item If $\delta\in\varphi(k)$, compute $\varphi^{-1}(\delta)\in k$.
  \end{itemize}
  We refer collectively to these problems as the \emph{Embedding
    evaluation}.
\end{enumerate}

\paragraph{Complexity notation} We measure all complexities in number
of operations $+$, $\times$, $\div$ in $\F_q$ unless explicitely
stated otherwise. We write $\MM(n)$ for
the cost of multiplying two polynomials in $\F_q[X]$ of degree at most
$n$ and $\MC(n)$ for the cost of modular composition of three
polynomials in $\F_q[X]$ of degree at most $n$.

% Remove? State something for MM?
$\MC(n)$ is theoretically $O(n^{1 + o(1)})$ operations in $F_q$
using Kedlaya-Umans algorithm~\cite{kedlaya+umans08},
and practically
$O(n^{(\omega + 1)/2})$ operations in $F_q$
using Brent-Kung algorithm~\cite{brent+kung}.

\subsection{Classical algorithms}

The classical way to deal with the above problems combines
root finding (or equal-degree factorization)
for the embedding description step
and linear algebra or modular composition
for the embedding evaluation step.

\subsubsection{Root finding}

As $k$ is defined as $k=\F_q[X]/f$, a natural choice is to
pick $\alpha = X\in k$
and $\beta$ a root of $f$ in $K$.
This trivially defines an embedding of $k$ into $K$.
The root computation can be solved using randomized algorithms
in~$\MC(\deg f) + O(\deg f \deg g \log q)$ operations
in $K$~\cite{von1992computing,KeUm11}.

\subsubsection{Linear algebra}

Once $\beta \in K$ has been computed as a polynomial in $Y$,
one can compute the powers
$\beta^i = \sum_{j=0}^{\deg g-1} m_{i,j} Y^j$
for $i \in \{0, \ldots, \deg f-1\}$ and build a matrix
$M = \{m_{i, j}\}_{0\leq i \leq \deg f-1, 0 \leq j \leq \deg g -1}$
representing $\varphi$.
This is trivially done in $O(\deg f)$ operations in $K$.
For $\gamma = \sum_{i = 0}^{\deg f -1} c_i X^i \in k$,
$\varphi(\gamma)$ can then be computed by a
matrix-vector multiplication in $O(\deg f \deg g)$ operations in $F_q$.

Together, the second and third questions are the inverse image problem.
They can be answered by first computing 
an LU or similar matrix decompostions of $M$
in $O((\deg g (\deg f)^{\omega - 1})$ operations in $F_q$.
Answering the second and third questions together is then
an easy matter.

Note that if $\deg f = \deg g$, that is if $k$ and $K$ are
isomorphic, then the second question is trivial.
For the third one, the inverse 
the inverse $M^{-1}$ of $M$ representing $\varphi^{-1}$
can be deduced from an an LU or similar matrix decompostions of $M$.
For $\delta \in K$, $\varphi^{-1}(\delta)$ can then be computed by a
matrix-vector multiplication in $O((\deg f)^2)$ in $F_q$.

\subsubsection{Modular composition}

As an alternative to using linear algebra,
$\varphi(\gamma)$ can be computed directly using modular composition
as $\beta(\gamma) \pmod{g}$ in $\MC(\deg g)$ operations in $F_q$.

The second question can be answered by performing a modular
exponentiation to check that $\gamma^{q^{\deg f}} = 1$
naively in $O(\deg f \log q)$ operations in $K$
or in $O(\log q)$ operations in $K$ plus
$O(\log \deg f) \MC(\deg g)$ operations in $F_q$ using modular composition.

The second and third questions can be answered using
dual bases and power projection/transposed modular composition
to express $\delta \in K$ as a polynomial in $\beta$ in
$\MC(\deg g)$ operations in $F_q$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\part{Embedding description}

Throughout this part we let $m=\deg f$ and $n=\deg g$, so that
$m|n$. The \emph{embedding description problem} asks to find two
elements $\alpha\in k$ and $\beta\in K$ such that $\alpha\mapsto\beta$
for some field embedding $\varphi:k\to K$. This is equivalent to
$\alpha$ and $\beta$ having the same minimal polynomial.

We note that it is enough to solve the following problem: let $r$ be a
prime power such that $r|m$ and $\gcd(r,m/r)=1$, find $\alpha_r\in k$
and $\beta_r\in K$ such that $\minpoly(\alpha_r)=\minpoly(\beta_r)$
and $\deg\minpoly(\alpha_r)=r$.

Indeed, once such $\alpha_r$ and $\beta_r$ are known for every primary
factor $r$ of $m$, possible solutions to the embedding problem are
\begin{equation*}
  \alpha = \prod_{\substack{r|m,\\\gcd(r,m/r)=1}}\alpha_r,\qquad
  \beta = \prod_{\substack{r|m,\\\gcd(r,m/r)=1}}\beta_r,
\end{equation*}
or
\begin{equation*}
  \alpha = \sum_{\substack{r|m,\\\gcd(r,m/r)=1}}\alpha_r,\qquad
  \beta = \sum_{\substack{r|m,\\\gcd(r,m/r)=1}}\beta_r.
\end{equation*}

In the next sections, we present algorithms to solve this problem.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Kummer-type algorithms}

In this section we review what we call \textit{Kummer-type} approaches to the isomorphism problem. 
We briefly review the works of Lenstra \cite{LenstraJr91}, and Allombert \cite{Allombert02}, and at 
the end we give a variant of these algorithms with a significantly lower running time complexity.

Let $F$ be an extension of degree $r$ of $E = \F_q$. In \cite{LenstraJr91}, Lenstra proves that 
given two finite fields of the same size, there exists a deterministic polynomial time algorithm 
that finds an isomorphism between them. The focus of the paper is on the theoretical construction 
of the isomorphism, and no precise complexity analysis is presented. However, since there is an 
explicit assumption of using linear algebra in the paper, a rough analysis of the algorithm yields 
an estimate of $O(r^3)$ operations in $E$. The idea of the algorithm is as follows. First, if 
the extension degree is equal to the charactristic the Artin-Schreier theory is used. Therefore, we 
assume $p \ne r$.

Let $E[\zeta]$ denote the ring extension $E[X] / \Phi_r(X)$ where $\Phi_r$ is the $r$th cyclotomic 
polynomial. Also let $\Delta$ denote the group of automorphisms $\Aut(E[\zeta]/E)$. Then we have 
$E[\zeta]^\Delta = E$. Let $E[\zeta][c^{1/r}]$ denote the quotient $E[\zeta][Y]/\ang{Y^r - c}$ such 
that $c^{1/r}$ is the residue class of $Y$. For a given element $c \in T_E$, where $T_E$ is the 
Teichm\"{u}ller subgroup \footnote{See the reference for details.} of $E[\zeta]$, the action of 
$\Delta$ can be extended over the ring $E[\zeta][c^{1/r}]$ by sending $c^{1/r}$ to powers 
$(c^{1/r})^\ell$ for certain integers $\ell$. If $c_1, c_2 \in T_E$ have the same order then we can 
find an isomorphism $E[\zeta][c_1^{1/r}] \cong E[\zeta][c_2^{1/r}]$ that is identity on $E[\zeta]$ 
and preserves the action of $\Delta$. In fact since $c_1$ and $c_2$ both generate the same 
subgroups, there is an integer $j > 0$ such that $c_1 = c_2^j$, and the isomorphism is given by
\[
\begin{array}{lrll}
	\psi: & E[\zeta][c_1^{1/r}] & \rightarrow & E[\zeta][c_2^{1/r}] \\
	& c_1^{1/r} & \mapsto & (c_2^{1/r})^j
\end{array}
\]
If $c$ is a generator of $T_E$ then we can show that $E[\zeta][c^{1/r}]^\Delta$ is a field 
extension of $E$ of degree $r$. Also, we can find an element $\gamma \in F[\zeta]$ such that $c 
= \gamma^r$ belongs to $E[\zeta]^*$ and	generates $T_E$. This gives an isomorphism $F[\zeta] \cong 
E[\zeta][c^{1/r}]$ that is identity on $E[\zeta]$, sends $\gamma$ to $c^{1/r}$, and preserve the 
action of $\Delta$. From this isomorphism we get the induced isomorphism $F \cong 
E[\zeta][c^{1/r}]^\Delta$. Therefore, given extensions $F_1, F_2$ of $E$ of degree $r$, we have 
built a chain
\begin{equation*}
	\begin{tikzpicture}
		\node (Ec1) {$E[\zeta][c_1^{1/r}]^\Delta$};
		\node[right = of Ec1] (Ec2) {$E[\zeta][c_2^{1/r}]^\Delta$};
		\node[left = of Ec1] (F1) {$F_1$};
		\node[right = of Ec2] (F2) {$F_2$};
		\draw[->] (F1) edge node[above, inner sep=0.5pt] {$\sim$} node[above = 3mm, inner 
		sep=0.5pt] {$\varphi_1$} node[below = 3mm, inner sep=0.5pt] {$\gamma \longmapsto 
		c_1^{1/r}$} (Ec1);
		\draw[->] (Ec1) edge node[above, inner sep=0.5pt] {$\sim$} node[above = 3mm, inner 
		sep=0.5pt] {$ \psi $} (Ec2);
		\draw[->] (Ec2) edge node[above, inner sep=0.5pt] {$\sim$} node[above = 3mm, inner 
		sep=0.5pt] {$ \varphi_2 $} node[below = 3mm, inner sep=0.5pt] {$c_2^{1/r} \longmapsto 
		\gamma_1$} (F2);
	\end{tikzpicture}
\end{equation*}
of isomorphisms. The following algorithm summarizes the process.
\begin{algorithm}[Lesntra]
	\begin{algorithmic}[1]
		\REQUIRE Field extensions $F_1, F_2$ of $E$ of degree $r$
		\ENSURE An isomorphism $\F_1 \xrightarrow{\sim} F_2$
		\STATE find a generator $c_i$ of $T_{F_i}$ for $i = 1, 2$
		\STATE find isomorphisms $\varphi_i: F_i \xrightarrow{\sim} E[\zeta][c_i^{1/r}]^\Delta$ for 
		$i = 1, 2$
		\STATE compute the integer $j$ such that $c_1 = c_2^j$
		\STATE build the isomorphism $\psi: E[\zeta][c_1^{1/r}]^\Delta \xrightarrow{\sim} 
		E[\zeta][c_2^{1/r}]^\Delta$
		\RETURN $\varphi_2 \circ \psi \circ \varphi_1$
	\end{algorithmic}
\end{algorithm}
A more careful look at the above approach suggests a trade-off between determinism and 
simplicity/practicality. For example, one can replace the ring extension $E[\zeta]$ with the field 
extension $E[\zeta] = E[X] / \ang{g}$ where $g$ is an irreducible factor of $\Phi_r$. This makes 
things simpler and more practical at the cost of factoring $\Phi_r$ which of course introduces 
indeterminism if one choses to use efficient factoring algorithms.

To find generators for the Teichm\"{u}ller subgroups, Lenstra uses some trace-like formula that 
suggests a version of Hilbert 90 Theorem over rings. Alombert's approach is more or less the same 
as above with more focus on implementation. The idea of the algorithm is to use cyclotomic field 
extensions which in turn allows a more explicit use of Hilbert 90 Theorem to find elements 
$\alpha_1 \in F_1[\zeta]$, and $\alpha_2 \in F_2[\zeta]$. Then $b = \alpha_1^r / \alpha_2^r$ is an 
$r$th power in $E[\zeta]$ from which $b^{1/r}$ can be computed using a root extraction algorithm. 
The isomorphism $F_1[\zeta] \xrightarrow{\sim} F_2[\zeta]$ is then given by $\alpha_1 \mapsto 
b^{1/r}\alpha_2$. Although again no rigorous complexity analysis is presented, one can easily see 
that the dominant cost of this algorithm is solving Hilbert 90 which is done using linear algebra. 
Therefore, the algorithm performs $O(n^{\omega + 1})$ many operations in $E$.


\subsection{Fast variant}
In this section we give an asymptotically faster and more practical version of the above 
algorithms. We replace linear algebra with polynomial arithmetic, and use a trace-like computation 
technique to solve Hilbert 90. 

An overview of the construction is as follows. For simplicity, we assume $q$ is prime in $E = 
\F_q$. Suppose we are given extensions $F_1, F_2$ of $E$ of prime degree $r \ne q$. Let $s$ be 
the order of $q$ in $\mathbb{Z} / r\mathbb{Z}$, and write $q^s - 1 = ur^t$ where $\gcd(r, u) = 1$. 
We first move to cyclotomic field extensions $E[\zeta], F_1[\zeta], F_2[\zeta]$ of degree $s$ over 
$E, F_1, F_2$ respectively, by obtaining an irreducible factor of the $r$th cyclotomic polynomial. 
Then there is a non-$r$-adic residue $\eta \in E[\zeta]$ such that $X^r - \eta$ is irreducible in 
$E[\zeta][X]$. Next we find elements $\alpha_1, \alpha_2$ in $F_1[\zeta], F_2[\zeta]$ to build 
isomorphisms $\varphi_1, \varphi_2$ as in Figure \ref{figure:isom1}. Once we obtain an isomorphism 
$F_1[\zeta] \rightarrow F_2[\zeta]$, we descend it down to an isomorphism $F_1 \rightarrow F_2$. 

Throughout this section we assume the representations
\begin{equation}
\label{equation:rep}
F_1 = E[X] / \langle f(X) \rangle, \; E[\zeta] = E[Z] / \langle g(Z) \rangle, \;
F_1[\zeta] = E[X, Z] / \langle f(X), g(Z) \rangle
\end{equation}
where $f(X) \in E[X]$ is an irreducible polynomial of degree $r$, and $g(Z)$ is an irreducible 
factor of the $r$-th cyclotomic polynomial $\Phi_r(Z)$. We also let $x, z = \zeta$ be the residue 
classes of $X, Z$ in these quotients.
\begin{figure}
	\begin{center}
		\begin{tikzpicture}
		\node (Fp) {$E$};
		\node[above = of Fp] (Fpz) {$E[\zeta]$};
		\node[above = of Fpz] (Fpzx) {$E[\zeta][X] / \langle X^r - \eta \rangle$};
		\node[left = of Fpzx] (F1z) {$F_1[\zeta]$};
		\node[right = of Fpzx] (F2z) {$F_2[\zeta]$};
		\node[below = of F1z] (F1) {$F_1$};
		\node[below = of F2z] (F2) {$F_2$};
		\draw (Fp) edge (F1) edge (F2) edge node[left, midway] {$s$} (Fpz)
		(Fpz) edge (Fpzx) edge[dashed] (F1z) edge[dashed] (F2z)
		(F1) edge node[left, midway] {$s$} (F1z)
		(F2) edge node[right, midway] {$s$} (F2z);
		\draw[->] (F1z) edge node[above, inner sep=0.5pt] {$ \sim $} node[above = 3mm, inner 
		sep=0.5pt] {$ \varphi_1 $} (Fpzx);
		\draw[->] (Fpzx) edge node[above, inner sep=0.5pt] {$ \sim $} node[above = 3mm, inner 
		sep=0.5pt] {$ \varphi_2 $} (F2z);
		\end{tikzpicture}
		\caption{Constructing isomorphisms}
		\label{figure:isom1}
	\end{center}
\end{figure}





%///////////////////////////////////////////

\subsubsection{Preliminaries}

As mentioned above, we let $s$ be the order of $q$ in $\mathbb{Z} / r\mathbb{Z}$, and write $q^s - 
1 = ur^t$ where $\gcd(r, u) = 1$. The obvious way constructing isomorphisms $\varphi_1, \varphi_2$ 
in Figure \ref{figure:isom1} is to compute an $r$-th root of $\eta$ in $F_1[\zeta], F_2[\zeta]$. 
But, as a more efficient way, we show how to avoid the costly operation of taking roots in these 
extensions, and skip some detail computations. We first need the following result.
\begin{proposition}
	\label{proposition:semi-trace}
	For an element $a \in F_1[\zeta]$ define 
	\begin{equation}
	\label{equation:semi-trace} 
	\theta_a = a + \zeta^{r - 1}a^{q^s} + \cdots + \zeta^2a^{q^{(r - 2)s}} + \zeta a^{q^{(r - 1)s}}
	\end{equation}
	Then
	\begin{enumerate}
		\item[\normalfont (i)] There is an $a \in F_1[\zeta]$ such that $\theta_a \ne 0$.
		\item[\normalfont (ii)] For a generator $\sigma$ of $\gal(F_1[\zeta] / E[\zeta])$ we have 
		$\sigma(\theta_a) / \theta_a = \zeta$. Also $\theta_a, \theta_a^r$ are non-$r$-adic 
		residues in $F_1[\zeta], E[\zeta]$ respectively.
	\end{enumerate}
\end{proposition}
\begin{proof}
	Let $v = u^{-1} \bmod r$, and let $\gamma \in F_1[\zeta]$ be an $r^t$-th root of $\zeta^{v(r - 
	1)}$. There exists an element $a \in F_1[\zeta]$ such that $\beta = T_{F_1[\zeta] / 
	E[\zeta]}(\gamma a) \ne 0$, and we have 
	\begin{equation}
		\label{equation:trace}
		\begin{aligned}
		\beta 
		& = \gamma a + (\gamma a)^{q^s} + \cdots + (\gamma a)^{q^{(r - 1)s}} \\
		& = \gamma (a + \gamma^{q^s - 1}a^{q^s} + \cdots + \gamma^{q^{(r - 1)s} - 1}a^{q^{(r - 
		1)s}}) \\
		& = \gamma (a + \gamma^{ur^t}a^{q^s} + \cdots + \gamma^{ur^t(q^{(r - 2)s} + \cdots + q^s + 
		1)}a^{q^{(r - 1)s}}) \\
		& = \gamma (a + \zeta^{r - 1}a + \cdots + \zeta a^{q^{(r - 1)s}}) \\
		& = \gamma \theta_a.
		\end{aligned}
	\end{equation}
	This proves (i). To prove (ii), first observe that $\theta_a^{q^s} = \zeta\theta_a$ so that 
	$\sigma(\theta_a) = \zeta\theta_a$ for a generator $\sigma: x \to x^{q^s}$ of $\gal(F_1[\zeta] 
	/ E[\zeta])$. Therefore, we have $\sigma(\theta_a^r) = \theta_a^r$, which means that 
	$\theta_a^r \in E[\zeta]$, and $\theta_a^{ur^t} = \theta_a^{q^s - 1} = \zeta$ which proves 
	that $\theta_a, \theta_a^r$ are non-$r$-adic residues.
\end{proof}
Let $\eta_a = \theta_a^r, \eta_b = \theta_b^r$ for nonzero $\theta_a, \theta_b$ as in Proposition 
\ref{proposition:semi-trace}. Then we can construct isomorphisms $\varphi_1, \varphi_2$ as in the 
following diagram.
\begin{equation}
	\label{equation:iso-chain}
	\begin{tikzpicture}
		\node (Fpzxa) {$E[\zeta][X] / \langle X^r - \eta_a \rangle$};
		\node[right = of Fpzxa] (Fpzxb) {$E[\zeta][X] / \langle X^r - \eta_b \rangle$};
		\node[left = of Fpzxa] (F1z) {$F_1[\zeta]$};
		\node[right = of Fpzxb] (F2z) {$F_2[\zeta]$};
		\draw[->] (F1z) edge node[above, inner sep=0.5pt] {$ \sim $} node[above = 3mm, inner 
		sep=0.5pt] {$ \varphi_1 $} node[below = 3mm, inner sep=0.5pt] {$\theta_a \longmapsto x$} 
		(Fpzxa);
		\draw[->] (Fpzxa) edge node[above, inner sep=0.5pt] {$ \sim $} node[above = 3mm, inner 
		sep=0.5pt] {$ \psi $} (Fpzxb);
		\draw[->] (Fpzxb) edge node[above, inner sep=0.5pt] {$ \sim $} node[above = 3mm, inner 
		sep=0.5pt] {$ \varphi_2 $} node[below = 3mm, inner sep=0.5pt] {$x \longmapsto \theta_b$} 
		(F2z);
	\end{tikzpicture}
\end{equation}
To complete this isomorphism chain, we need to compute $\psi$. For that we simply compute an $r$-th 
root of $\eta_a$ in $E = E[\zeta][X] / \langle X^r - \eta_b \rangle$, and construct the 
isomorphism in the obvious way. Note that from (\ref{equation:trace}) we have $\beta_a = 
\gamma_a\theta_a$,  $\beta_b = \gamma_b\theta_b$, and we can choose $\gamma_a, \gamma_b$
such that $\gamma_a^r = \gamma_b^r$. Therefore, 
\[ \eta_a\eta_b^{-1} = \beta_a^r\beta_b^{-r} = (\beta_a\beta_b^{-1})^r = c^r. \] 
So we can construct the isomorphism
\begin{equation*}
	\begin{array}{rrll}
	\psi: & E[\zeta][X] / \langle X^r - \eta_a \rangle & \longrightarrow & E[\zeta][X] / 
	\langle X^r - \eta_b \rangle \\
	& x & \longmapsto & cx
	\end{array}
\end{equation*}
by computing an $r$-th root in $E[\zeta]$.




%///////////////////////////////////////////

\subsubsection{Computing $\theta_a$}

Let $a \in F_1[\zeta]$. To compute $\theta_a$, we use a binary powering scheme similar to the one 
in \cite{doliskanischost2011}. Assuming the representations (\ref{equation:rep}) we let 
\[
\xi_i = x^{q^{is}}, \quad
\delta_i = a + z^{r - 1}a^{q^s} + \cdots + z^2a^{q^{(i - 1)s}} + z^{r - i + 1} a^{q^{(i - 1)s}}.
\]
Then we have the following relations:
\[\xi_1 = x^{q^s}, \quad \delta_1 = a, \]
\[
\xi_i =
\begin{cases}
\xi_{i / 2}^{q^{is / 2}} & \text{if $i$ is even}  \\
\xi_{i - 1}^{q^s} & \text{if $i$ is odd,}
\end{cases} \quad
\delta_i=
\begin{cases}
z^{r - i / 2}\delta_{i / 2}^{q^{is / 2}} + \delta_{i / 2} & \text{if $i$ is even} \\
z^{r - 1}\delta_{i - 1}^{q^s} + \delta_1 & \text{if $i$ is odd}
\end{cases}
\]
Assuming $\xi_i = x^{q^{is}}$ is already known, $\delta_i$ can be computed using the following 
algorithm.

\begin{algorithm}
	[XiDelta$(i, \xi_1,\delta_1)$]
	\label{algorithm:xidelta}
	\begin{algorithmic}[1]
		\REQUIRE a positive integer $i$, $\xi_1 = x^{q^s}$, $\delta_1 = a$
		\ENSURE $\xi_i$, $\delta_i$
		\IF {$i=1$} 
		\RETURN $\xi_1$, $\delta_1$
		\ENDIF
		\STATE $j \leftarrow \lfloor i/2\rfloor$
		\STATE $\xi_{j}, \delta_j \leftarrow {\rm XiDelta}(j,\xi_1,\delta_1)$ 
		\STATE\label{step:xi} $\xi_{2j} \leftarrow \xi_j(\xi_j)$
		\STATE\label{step:delta} $\delta_{2j} \leftarrow z^{r - j}\delta_j(\xi_j) + \delta_j$
		\IF {$i$ is even} 
		\RETURN $\xi_{2j}$, $\delta_{2j}$
		\ENDIF
		\STATE $\xi_i \leftarrow \xi_{2j}(\xi_1)$
		\STATE $\delta_i \leftarrow z^{r - 1}\delta_j(\xi_1) + \delta_1$
		\RETURN $\xi_i$, $\delta_i$
	\end{algorithmic}
\end{algorithm}

\begin{proposition}
	\label{proposition:XiDelta}
	Finding a nonzero $\theta_a$ for random $a \in F_1[\zeta]$ takes \[O(s\CC(r)\log(r) + 
	\MM(r)\log(q))\] operations in $E$.
\end{proposition}
\begin{proof}
	To compute the initial value $\xi_1 = x^{q^s}$ we first compute $x^q$, and then do $\log(s)$ 
	modular compositions at a total cost of $O(\MM(r)\log(q) + C(r)\log(s))$ operations in $E$. 
	Then $\theta_a = \delta_r$ is computed using Algorithm \ref{algorithm:xidelta}: the complexity 
	of the algorithm is dominated by steps \ref{step:xi}, \ref{step:delta}. The former is a
	modular composition in $E[X]$ which takes $C(r)$ operations in $E$. For the later suppose 
	$\delta_j = \delta_{j,0}(x) + \delta_{j,1}(x)z + \cdots + \delta_{j,s - 1}(x)z^{s - 1}$. Then   
	\[ \delta_j(\xi_j) = \sum_{i = 0}^{s - 1}\delta_{ij}(\xi_j)z^i, \] which is done using 
	$O(s\CC(r))$ operations in $E$. Accounting for a recursion depth of $\log(r)$, the running 
	time of the algorithm is then $O(s\CC(r)\log(r))$ operations in $E$. All in all, we get the 
	claimed 
	complexity.
\end{proof}
The above running time for computing $\theta_a$ is only acceptable for small $s$. More precisely, 
if we take $\CC(r) = O(r^{(1 + \omega) / 2})$ then the running time becomes quadratic if $s \approx 
r^{(3 - \omega) / 2}$. We call $s$ small if $s < r^{(3 - \omega) / 2}$, and large otherwise. To 
keep the complexity at most quadratic for all $s$, we proceed as follows. We know that 
$T_{F_1[\zeta] / E[\zeta]}(\gamma x^\ell) \ne 0$ for at least one $1 \le \ell \le r - 1$, otherwise 
$T_{F_1[\zeta] / E[\zeta]}(\gamma a) = 0$ for all $a \in F_1[\zeta]$ by linearity. Therefore, the 
linear map 
\[
\begin{array}{rrll}
	T_{F_1[\zeta] / E[\zeta]}\vert_{F_1}: & F_1 & \longrightarrow & E[\zeta] \\
	& d(x) & \longmapsto & T_{F_1[\zeta] / E[\zeta]}(\gamma d(x))
\end{array}
\]
is not identically zero. This implies that we need to try at most $O(1)$ random $d(x) \in F_1$ to 
obtain a nonzero
\[ \theta_{d(x)} = d(x) + \zeta^{r - 1}d(x)^{q^s} + \cdots + \zeta^2d(x)^{q^{(r - 2)s}} + \zeta 
d(x)^{q^{(r - 1)s}}. \]
The sequence $d(x), d(x)^{q^s}, \dots, d(x)^{q^{(r - 1)s}}$ in $F_1$ can be computed by Algorithm 
3.1 in \cite{von1992computing} using $O(\MM(r^2)\log(r))$ operations in $E$. Therefore, we have 
proved the following,
\begin{proposition}
	\label{proposition:XiDelta-updated}
	Finding a nonzero $\theta_a$ for random $a \in F_1[\zeta]$ takes
	\begin{itemize}
		\item $O(s\CC(r)\log(r) + \MM(r)\log(q))$ operations in $E$ for small $s$, or
		\item $O(\MM(r^2)\log(r) + \MM(r)\log(q))$ operations in $E$ for large $s$.
	\end{itemize}
\end{proposition}



%///////////////////////////////////////////

\subsubsection{Computing $r$-th roots in $E[\zeta]$}
\label{subsection:rth-root-fpz}

Let $a \in E[\zeta]$ be an $r$-th power. To compute an $r$-th root of $a$ we factor the 
polynomial $X^r - a$ using the Equal Degree Factorization algorithm given in 
\cite{kaltofen+shoup97}.
\begin{algorithm}
	[Root Finding]
	\label{algorithm:edf}
	\begin{algorithmic}[1]
		\REQUIRE a square-free polynomial $f \in E[\zeta][x]$ of degree $n$ with linear factors
		\ENSURE a single factor of $f$
		\IF {$\deg f = 1$}
		\RETURN $f$
		\ENDIF
		\STATE Pick a random element $\alpha \in \mathbb{A}_f = E[\zeta][x]/\langle f \rangle$
		\STATE\label{step:edf-trace} Compute the following trace in $\mathbb{A}_f$
		\[ \beta = \alpha + \alpha^q + \alpha^{q^2} + \cdots + \alpha^{q^{s - 1}} \]
		\STATE $\gamma \leftarrow \beta^{(q - 1) / 2}$
		\STATE $g \leftarrow \gamma \bmod f$, $g_1 \leftarrow \gcd(g, f)$, $g_2 \leftarrow \gcd(1 + 
		g, f)$
		\STATE Recursively factor one of $g_1, g_2$ that is non-constant
	\end{algorithmic}
\end{algorithm}
The dominant cost of the algorithm comes from Step \ref{step:edf-trace}, which is done as follows. 
Let
\[ \beta_i = \alpha^q + \alpha^{q^2} + \cdots + \alpha^{q^i}, \quad \xi_i = x^{q^i}, \quad \zeta_i 
= z^{q^i}. \]
Then we have $\beta_1 = \alpha^q$, $\xi_1 = x^q$, $\zeta_1 = z^q$, and
\[
\beta_j = 
\begin{cases}
	\beta_{j / 2} + \beta_{j / 2}^{q^{j / 2}} & j \text{ even} \\
	\beta_1 + \beta_{j - 1}^q & j \text{ odd}
\end{cases}, \quad
\xi_j = 
\begin{cases}
	\xi_{j / 2}^{q^{j / 2}} & j \text{ even} \\
	\xi_{j - 1}^q & j \text{ odd}
\end{cases}, \quad
\zeta_j = 
\begin{cases}
	\zeta_{j / 2}^{q^{j / 2}} & j \text{ even} \\
	\zeta_{j - 1}^q & j \text{ odd}
\end{cases}
\]
For a positive integer $j$ we have
\begin{equation}
	\label{equation:betaj}
	\beta_j^{q^j} = \left( \sum_{l = 0}^{n - 1}c_l(z)x^l \right)^{q^j} = \sum_{l = 0}^{n - 
	1}c_l(z^{q^j})(x^{q^j})^l = \sum_{l = 0}^{n - 1}c_l(\zeta_j)\xi_j^l.
\end{equation}
Therefore we have a recursive algorithm for computing $\beta = \beta_{s - 1}$. Let us analyze the 
complexity of the algorithm. First note that we always have $z^r = 1, x^r = a$. This makes it 
possible to keep the identities simple and do the reductions at the end of each step. For example 
$x^q = a^{\lfloor q / r\rfloor}x^{q \bmod r}$ which can be computed using $O(\MM(s)\log(q))$
operations in $E$. At step $j$ of the recursion we have the following costs in $E$:
\begin{itemize}
	\item $O(\MM(r) + \MM(s)\log(r))$ for computing $x^{q^j}$, and computing $z^{q^j}$ is free.
	\item If $s$ is small we can first reduce $z^{q^j \bmod r}$ modulo $g(Z)$, and then do $n$ 
	modular compositions at a total cost
	of $O(\MM(r) + n\CC(s))$. But if $s$ is large we can reduce $c_l(z^{q^j \bmod r})$ modulo 
	$g(Z)$ for all $0 \le l < n$ at a total cost of $O(n\MM(r))$.
	\item $O(n\MM(s))$ for evaluating $\beta_j$ at $x^{q^j}$ using Horner's method.
	\item $O(\MM(r)\MM(s))$ for reducing (\ref{equation:betaj}) modulo $f$.
\end{itemize}
The depth of the recursion is $\log(s)$, hence $\beta$ can be computed in
\begin{itemize}
	\item $O(\MM(s)\log(q) + n\CC(s)\log(s) + \MM(r)\MM(s)\log(s))$ operations in $E$ for small 
	$s$, or
	\item $O(\MM(s)\log(q) + n\MM(r)\log(s) + \MM(r)\MM(s)\log(s))$ operations in $E$ for large 
	$s$.
\end{itemize} 
Finally since the depth of the recursion in Algorithm \ref{algorithm:edf} is $\log(r)$, we have the 
following.
\begin{proposition}
	\label{proposition:root-fpz}
	The total cost of root finding in $E[\zeta]$ is
	\begin{itemize}
		\item $O(\MM(s)\log(q)\log(r) + r\CC(s)\log(s) + \MM(r)\MM(s)\log(s)\log(r))$\\ operations 
		in $E$ for small $s$, or
		\item $O(\MM(s)\log(q)\log(r) + r\MM(r)\log(s) + \MM(r)\MM(s)\log(s)\log(r))$\\ operations 
		in $E$ for large $s$.
	\end{itemize}
\end{proposition}





%///////////////////////////////////////////

\subsubsection{Computing the isomorphism $F_1 \rightarrow F_2$}

In this section, we analyze the computational cost of building an isomorphism $\varphi: F_1 
\rightarrow F_2$. We first construct the isomorphism $\varphi_2 \circ \psi \circ \varphi_1 : 
F_1[\zeta] \rightarrow F_2[\zeta]$ as in (\ref{equation:iso-chain}), and then descend back to the 
desired fields. The following algorithm builds the above chain of isomorphism based on the 
observations at the start of the section. 
\begin{algorithm}
	[Isomorphism ${F_1[\zeta] \rightarrow F_2[\zeta]}$]
	\label{algorithm:ext-iso}
	\begin{algorithmic}[1]
		\REQUIRE degree $r$ extensions $F_1, F_2$ of $E$
		\ENSURE an isomorphism $F_1[\zeta] \rightarrow F_2[\zeta]$
		\STATE\label{step:factor-cyclo} factor the cyclotomic polynomial $\Phi_r(Z)$ over $E$ to 
		build extensions $E[\zeta],	F_1[\zeta], F_2[\zeta]$
		\REPEAT
		\STATE choose a random $a \in F_1[\zeta]$
		\STATE compute $\theta_a$ using Algorithm \ref{algorithm:xidelta}
		\UNTIL {$\theta_a \ne 0$}
		\REPEAT
		\STATE choose a random $b \in F_2[\zeta]$
		\STATE compute $\theta_b$ using Algorithm \ref{algorithm:xidelta}
		\UNTIL {$\theta_b \ne 0$}
		\STATE\label{step:gamma-pow} $\eta_a \leftarrow \theta_a^r$ , $\eta_b \leftarrow \theta_b^r$
		\STATE\label{step:psi} construct the isomorphism $\psi$ as in (\ref{equation:iso-chain})
		\STATE construct $F_1[\zeta] \rightarrow F_2[\zeta]$ as in (\ref{equation:iso-chain})
	\end{algorithmic}
\end{algorithm}
\begin{proposition}
	Algorithm \ref{algorithm:ext-iso} computes the isomorphism $F_1[\zeta] \rightarrow F_2[\zeta]$ 
	using
	\begin{itemize}
		\item $O(s\CC(r)\log(r) + \MM(r)\log(q) + \MM(s)\log(q)\log(r))$\\ operations in $E$ for 
		small $s$, or
		\item $O(\MM(r)\log(q) + \MM(s)\log(q)\log(r) + \MM(r^2)\log(r) +  
		\MM(s)\MM(r)\log(s)\log(r))$\\ 
		operations in $E$ for large $s$.
	\end{itemize}
\end{proposition}
\begin{proof}
	By \cite[Theorem 9]{shoup94} Step \ref{step:factor-cyclo} takes $O(r\log^2(r) + 
	r\log(r)\log(q))$ operations in $E$. The running time of the two repeat...until loops is 
	given by Proposition \ref{proposition:XiDelta-updated}. Step \ref{step:gamma-pow}
	is done using $O(\MM(s)\MM(r)\log(r))$ operations in $E$. The running time of Step 
	\ref{step:psi} is given by Proposition \ref{proposition:root-fpz}. Adding all these up proves 
	the proposition.
\end{proof}
So, now we have an isomorphism $\phi: F_1[\zeta] \rightarrow F_2[\zeta]$ that sends $\theta_a$ to 
some $h(z, x) \in F_2[\zeta]$. To construct the isomorphism $\varphi: F_1 \rightarrow F_2$ we the 
technique in \cite{Allombert02}. Let 
\[ \theta_a = \sum_{i = 0}^{s - 1}f_i(x)z^i, \quad\text{and}\quad z^s = (v(z)  \bmod g(z)) = 
\sum_{i = 0}^{s - 1}v_iz^i. \] 
Then since $\theta_a^{q^s} = z\theta_a$ we have
\[ \sum_{i = 0}^{s - 1}f_i(x)^{p^s}z^i = f_{s - 1}(x)v(z) + f_0(x)z + \cdots + f_{s - 2}(x)z^{s - 
1}.\]
After rearranging the terms in the right hand side, this gives us the identities
\[
\begin{array}{ccc}
	f_0(x)^{p^s} & = & v_0f_{s - 1}(x) \\
	f_1(x)^{p^s} & = & f_0(x) + v_1f_{s - 1}(x) \\
	\vdots & \vdots & \vdots \\
	f_{s - 1}(x)^{p^s} & = & f_{s - 2}(x) + v_{s - 1}f_{s - 1}(x)
\end{array} 
\]
form which we see that $f_i(x) \in E(f_0(x)) \subseteq F_1$ for all $i$. We prove $E(f_0) = 
F_1$. Let $\sigma \in \gal(F_1(z) / E)$ be a generator, and let $j \le r$ be the smallest 
integer such that $\sigma^jf_0 = f_0$. Then $\sigma^{js}\theta_a = \theta_a$, but $\theta_a$ is not 
contained in any proper subfield; so $j = r$. Let $h_0$ be the constant term of $h(z, x)$. Then we 
similarly have $F_2 = E(h_0)$. This gives us an isomorphism
\[
\begin{array}{rlll}
	\phi: & F_1 & \longrightarrow & F_2 \\
	& f_0 & \longmapsto & h_0
\end{array}
\]
from which we can get an isomorphism
\[
\begin{array}{rlll}
	\phi: & F_1 & \longrightarrow & F_2 \\
	& x & \longmapsto & a(x)
\end{array}
\]
using transposed modular composition.

\subsubsection{The Artin-Schreier case}
\label{sec:artin-schreier-case}

\todo{We have to write at least a few paragraphs on how to handle this case.}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Rains' algorithm}

In his paper, Pinch \cite{} proposed to use specific generating element to solve
the isomorphism problem. One of his two methods makes use of the cyclotomic
extension.

Let $\F_q$ be a finite field of characteristic $p$ and let $n$ be an integer. 
Now, let $m$ be an integer such that the primitive $m$th roots span 
$\F(q^n)$, and let $f$ and $g$ be two different irreducible polynomial of
degree $n$ over $\F_q$. We note
\begin{equation}
k_1 := \F_q[X]/(f)\text{ and }k_2 := \F_q[X]/(g)
\end{equation}
Pinch's method consists of finding primitive $m$th roots of unity in both extensions
$k_1$ and $k_2$, which we will called $\alpha$ and $\beta$ respectively, then
find the morphism
\begin{equation}
\varphi_e : \alpha\longmapsto\beta^e
\end{equation}
which actually defines an isomorphism.

One of the issue with this method is that the order of $\F(q^n)$ may only be
divisible by large integers, increasing drastically the time it takes to find a 
$m$th root of unity in each extensions. Another issue is the random choice of
primitive $m$th roots. Due to how the cyclotomic polynomial factors in
charateristic $p$, it could take $O(m)$ tries to find two roots which are not in
the same irreducible factor.


\subsection{Gaussian periods}

A solution to the problem mentionned above would be to find a way to generate
elements which define an isomorphism. Those elements are the \emph{Gaussian
periods} that will be introduced in this section.

Let $L$ be a number fields of degree $\ell$ and $\mathcal{O}_{K}$ its ring of
integers. Let $q = p^{\ell}$ and $\mu_m$ be the abstract group of $m$th roots of
unity. If we let $\mathfrak{p}$ be the ideal of $L$ above $p$ such that
$\mathcal{O}_L/\mathfrak{p} = \F_q$ and $\mathfrak{P}$ one of its irreducible 
factors in $L[\mu_m]$, we have the following situation.


\begin{center}
\begin{tikzpicture}
    \node (Q) {$\Q$};
    \node[above =1.5cm of Q] (Qm) {$\Q[\mu_m]$};
    \node[above right=1cm and 2cm of Q] (L) {$L$};
    \node[above =1.5cm of L] (Lm) {$L[\mu_m]$};
    \node[right =3cm of Lm] (Fqm) {$\F_q[\mu_m]$};
    \node[below =1.4cm of Fqm] (Fq) {$\F_q$};
    \node[below right=1cm and 1.15cm of Fqm] (Fpm) {$\F_p[\mu_m]$};
    \node[below =1.3cm of Fpm] (Fp) {$\F_p$};
    \draw (Q) edge node[left] {\small $(\Z/m\Z)^{\times}$} (Qm); 
    \draw (L) edge node[left] {\small $G$} (Lm); 
    \draw (Fqm) edge node[right] {\small $\langle{q}\rangle$} (Fq); 
    \draw (Fpm) edge node[right] {\small $\langle{p}\rangle$} (Fp); 
    \draw (Q) edge node {} (L);
    \draw (Qm) edge node {} (Lm);
    \draw (Fqm) edge node {} (Fpm);
    \draw (Fq) edge node {} (Fp);
    \draw[->>] (Q) edge node[above] {$\bmod\, p$} (Fp);
    \draw[->>] (L) edge node[above] {$\bmod\, \mathfrak{p}$} (Fq);
    \draw[->>] (Lm) edge node[above] {$\bmod\, \mathfrak{P}$} (Fqm);
\end{tikzpicture}
\end{center}

where $G$ is the Galois group of $L[\mu_m]/L$ subgroup of $(\Z/m\Z)^{\times}$
and $\langle{q}\rangle$, $\langle{p}\rangle$ are the decomposition groups of
$\mathfrak{P}/\mathfrak{p}$ and $\mathfrak{p}/p$ respectively.

\begin{definition}
Let us assume that there exists a subgroup $S\subset(\Z/m\Z)^{\times}$ such that
\begin{equation}
(\Z/m\Z)^{\times} = \langle{q}\rangle \times S.
\end{equation}
Then for every generator $\zeta_m$ of $\mu_m$, we define the Gauss periods
$\eta(\zeta_m)$ as follow
\begin{equation}
\eta(\zeta_m) = \sum_{\sigma\in S}{\zeta_m^{\sigma}}.
\end{equation}
\end{definition}

\subsection{Rains' special algorithm}

\subsection{Rains' cyclotomic algorithm}

\subsection{Complexity analysis}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Elliptic Rains' algorithm}

In \cite{Pinch}, Pinch already proposed to use the torsion point of an elliptic
curve in place of the roots of unity. Rains also mentionned this possiblity, 
but judges that as far as he could see it would not bring significant 
improvements.
 
In practice the use of auxiliary extensions in the cyclotomic method costs a of
ressources.We will see that, contrary to Rains' belief, in the cases where an
auxiliary extention is necessary, the elliptic variant is actually more 
competitive.

In the next sections, we will first introduce the \emph{elliptic periods} which 
plays a similar role as the Gaussian periods, then we will describe the
algorithm itself and finally we will compute its complexity; which will
roughly be $\tildO(n^2)$ just like the other variants, the difference will be 
on the constant of the big $O$.

\subsection{Elliptic periods}

In the previous section, the group used to compute our generating elements was
the group of primitive roots of unity. For this variant, we use the group of
torsion point of a certain elliptic curve. There are polynomials that encode 
torsion points, they are called divisions polynomial. Let 
\begin{equation}
E : y^2 = x^3 + Ax + B
\end{equation}
be the weierstrass equation of an elliptic curve $E/\F_q$ with $A,B\in\F_q$.
We define the division polynomials as follow. We have $\psi_m\in\Z[x,y,A,B]$ and 
\begin{align*}
\psi_1 &=1,\\
\psi_2 &= 2y,\\
\psi_{3} &= 3x^{4} + 6Ax^{2} + 12Bx - A^{2}.
\end{align*}
Inductively, we deduce that
\begin{align*}
\psi_{2m+1}&=\psi_{m+2}\psi_{m}^{3}-\psi_{m-1}\psi^{3}_{m+1}
&&\text{ for }m\geq2,\\
\psi_{2m}&=\left(\frac{\psi_{m}}{2y}\right)\cdot(
\psi_{m+2}\psi^{2}_{m-1}-\psi_{m-2}\psi^{2}_{m+1})&&\text{ for }m\geq
3.
\end{align*}
More precisely, the roots of $\psi_m$ are exactly the abscissas of the
points in $E[m]$. Since $E[m]$ is either isomorphic to $\Z/m\Z\times\Z/m\Z$,
$\Z/m\Z$ or $0$, we have the following
\begin{equation}
\deg(\psi_m) = \begin{cases}
   \tfrac{(m^2-1)}{2} &\text{ if }E[m]\simeq\Z/m\Z\times\Z/m\Z\\
   \tfrac{(m-1)}{2} &\text{ if }E[m]\simeq\Z/m\Z\\
   0 &\text{ if } E[m]\simeq\lbrace{0}\rbrace\\
\end{cases}
\end{equation}
As for the roots of unity in the cyclotomic section, the goal will be to sum
specific roots of a division polynomial to generate elements with a common orbit
under the action of a certain Galois group. But for our algorithm to work, we need
the degree to be equal to $(m^2 - 1)/2$ and for that we have to introduce the
\emph{Elkies prime}.

\begin{definition}
Let $E/\F_q$ be an elliptic curve, let $m$ be a prime, we say that $m$
is an Elkies prime for $E$ if the charateristic polynomial of its Frobenius
$\pi_q : (X, Y, Z) \to (X^q, Y^q, Z^q)$ splits in $\Z/m\Z$, in other words
\begin{equation}
X^2 - tX + q = (X - a)(X - b) \bmod m
\end{equation}
for $a,b\in\Z/m\Z$ and $t$ the trace of the Frobenius $\pi_q$ such that 
$\# E(\F_q) = q + 1 - t$.
\end{definition}

\begin{remark}
If $m$ is an Elkies prime for $E$, then there exists a basis such that the 
Frobenius acts as a diagonale matrix on $E[m]$, on which the restriction of
$\pi$ is decomposed in two eigenspaces; the eigenvalues are the root of the 
characteristic polynomial of the Frobenius. Therefore, we can find a basis where
the Frobenius acts on the torsion point as a diagonale matrice :
\begin{equation}
\begin{pmatrix}
a & 0\\
0 & b
\end{pmatrix}.
\end{equation}
For all integer $n$, the action Frobenius of $E/\F_{q^n}$ will be the $n$th
power of that matrix. Additionnaly, if you note $k =
\textup{min}(\order_m(a),\order_m(b))$ then the extension $\F_{q^k}$ is
the smallest extension on which there are $m$-torsion points. Indeed, let $k = 
\order_m(a)$ and $P$ be in the eigenspace of $a$, then we have the following
\begin{equation}
\pi_{q^k}(P) = [a^k]P = [1] = P
\end{equation}
\end{remark}

The use of elliptic curve raises another kind of problem that was not present 
in the cyclotomic version of Rains' algorithm. The fact is elliptic curves 
come with non trivial automorphisms that can't be ignored. This will be taken 
in account in the definition of the elliptic periods. In particular, the cases 
$j = 0, 1728$ shall be dealt more specifically. We shall focus only on the case
$n$ odd.

\begin{definition}
\label{definition:ellperiod}
Let $E/\F_q$ be an elliptic curve and let $m>2$ be an Elkies prime for $E$.

Let $j\neq0, 1728$. Let $a$ be an eigenvalue of $\phi_q \bmod m$. Suppose there 
exists a subgroup $S$ of $(\Z/m\Z)^{\times}$ such that 
\begin{equation}
(\Z/m\Z)^{\times}/\lbrace{\pm1}\rbrace = \langle{a}\rangle \times S
\end{equation}
Then for every $P\in E[m]$ in the eigenspace generated by $a$, we define
the elliptic periods as follow
\begin{equation}
\eta_{a}(P) = \sum_{\sigma\in S}{\left([\sigma]P\right)_X}
\end{equation}
where $P_X$ denotes the abscissa of the point $P$.

For the cases $j = 0$ or $1728$, we have to take in account the size
of $\Aut(E)$. Namely, we shall assume that its order divides $\varphi(m)$
then we identify it to a subgroup of $(\Z/m\Z)^{\times}$. Assume there exists a
subgroup $S$ such that
\begin{equation}
(\Z/m\Z)^{\times}/\Aut(E) = \langle{a}\rangle\times S
\end{equation}
Then for every $P\in E[m]$ in the eigenspace generated by $a$, we define
the elliptic periods as follow
\begin{equation}
\eta_{a}(P) = \sum_{\sigma\in
S}{\left([\sigma]P\right)_X^{\#\Aut(E)/2}}
\end{equation}

\end{definition}

\begin{example}
A simple fact in favour of taking the automorphism group of $E$ into account is
easily illustrated in the case $j\neq0,1728$. In this case, $\Aut(E) =
\lbrace{\pm1}\rbrace$ and since $P_X = (-P)_X$, we would be actually summing the
same element two times; which isn't necessary to what we do.

However, another more pathological issue arises when we are working on the
specific case $j = 0$ or $1728$. Let us take a closer look to an elliptic curve
$E$ of $j$-invariant $j_E = 1728$. %TODO

\end{example}

Let us formulate the main theorem of the section. 

\begin{theorem}
\label{theorem:ellperiods}
Let $m$ be a prime different from $p$, $n$ an odd integer and $t$ an integer 
such that 

\begin{enumerate}
    \item $\mid t\mid < \sqrt{2q}$,
    \item $X^2 - tX + q = (X - a)(X - b)\bmod m,$
    \item $(\Z/m\Z)^{\times}/\Aut(E) = \langle{a}\rangle \times S$ for $S$ a subgroup of
$(\Z/m\Z)^{\times}$,
    \item $\order_m(a) = n$ and $\order_m(b)\not|n$.
\end{enumerate}
Now, let $E/\F_q$ be an elliptic curve of trace $t$. Then $\F_{q^n}$ contains 
$m$-torsion points and for all $P$ in the eigenspace of $a$, the elliptic 
period $\eta_a(P)$ form a normal basis of $\F_{q^n}$ on $\F_q$.

\end{theorem}
\begin{proof}
Let us take a step back in characteristic $0$. We denote $L$ the number field 
such that there exists a prime ideal $\mathfrak{p}$ above $p$ satisfying 
\begin{equation}
\mathcal{O}(L)/\mathfrak{p} \simeq \F_q.
\end{equation}
We denotes by $\widehat{E}$ the lift of $E$ in $L$,
\[
\widehat{E} : Y^2 = X^3 + \widehat{A}X + \widehat{B}
\]
Similarly, we define $\widehat{\psi}_{m,a}, \widehat{\psi_m}$ the lifts of 
$\psi_{m,a}, \psi_m$ respectively. Now let $L_m := 
L[X]/(\widehat{\psi}_m(X))$ be the extension of degree $(m²-1)/2$ and let 
$R_m := L_m[Y]/(Y^2 - X^3 + \widehat{A}X + \widehat{B})$. We also write $\Theta
:=\bar{X}$ and $\Gamma:=\bar{Y}$, $P:=(\Theta, \Gamma)$ will denote the generic 
point of $E[m]$.

For $o\in(\Z/m\Z)^{\times}$ we write
\begin{equation}
\rho_o : \Theta \mapsto ([o]\widehat{P})_X
\end{equation}
which define an autormorphism of $L_m/L$. Let $G := \lbrace{\rho_o : 1 \leq o
\leq (m-1)/2}\rbrace$, subgroup of the Galois group $\text{Gal}(L_m/L)$; we also 
write $L_0 := L_m^G$. With that definition we can write 
\begin{equation}
\widehat{\psi}_{m,a}=\prod_{o=1}^{\tfrac{m-1}{2}}{(X-\rho_o(\Theta))}
\end{equation}
with coefficient in $K_0$, consequently $L_m = L_0[T]/(\widehat{\psi}_{m,a}(T))$.
\emph{(Moreover, since $G$ is cyclic, for each $o\in G$ there exists a polynomial
$\widehat{g}_o$ of degree $\text{deg}(\widehat{g}_o) < (m-1)/2$ such that
$\widehat{g}_o(\Theta) = \rho_o(\Theta)$.)Useful ?}

\begin{remark}
Since the extension is cyclic, it is a noticibly interesting fact to note that
\[
\lbrace{\rho(\Theta), \rho\in G}\rbrace
\]
actually forms a normal basis of $L_m/L_0$.
Therefore, for any intermediate extension $L'/L_0$ of $L_m/L_0$, the trace
$\text{Tr}_{L_m/L'}(\Theta)$ along with its conjugates also form a normal basis
of $L'/L_0$ and thus generates $L'$ as simple extension.
\end{remark}

Now consider the subfield $L'\subset L_m$ such that $[L', L_0] = n$. Let 
$c\in(\Z/m\Z)^{\times}$ be a generator such that $a=c^{n'}$ and let $s:=c^n$ 
where $n' = (m-1)/2n$. Then we have the following decomposition
\[
(\Z/m\Z)^{\times}/\lbrace{\pm1}\rbrace = \langle{a}\rangle \times S
\]
with $S = \langle{s}\rangle$. For $0 \leq i < n$, we define 
\begin{equation}
\widehat{\eta}_i = \sum_{\sigma\in S}{\left([a^i\sigma]P\right)_X} =
\sum_{\sigma\in S}{\rho_{\sigma}(\rho_{a^i}(\Theta))}
\end{equation}
It is easy to see that $\widehat{\eta_0}$ is the lift of our elliptic periods.
From above we can deduce that $\rho_{a^i}(\widehat{\eta}_0) = 
\widehat{\eta_i}$, then we have the cyclic action
\begin{equation}
\widehat{\eta}_0 \buildrel\rho_a\over\longrightarrow
\widehat{\eta}_1 \buildrel\rho_a\over\longrightarrow \dots 
\buildrel\rho_a\over\longrightarrow \widehat{\eta}_{n-1}
\buildrel\rho_a\over\longrightarrow \widehat{\eta}_0
\end{equation}
Another notable fact, is that we actually have
\begin{equation}
\widehat{\eta}_0=\text{Tr}_{L_m/L'}(\Theta).
\end{equation}
therefore $L' = L(\widehat{\eta}_0)$.

\begin{lemma}
Consider the polynomial :
\begin{equation}
\widehat{M}(T):=\prod_{i=0}^{n-1}{(T-\widehat{\eta}_i)}\in\mathcal{O}(L_0)[T]
\end{equation}
It is the minimal polynomial of $\widehat{\eta}_0$.
\end{lemma}

\begin{proof}
From what we wrote above we are in the following situation
\begin{center}
\begin{tikzpicture}
    \node (L0) {$L_0$};
    \node[above left= of L0] (Lpr) {$L'$};
    \node[above right= of Lpr] (Lm) {$L_m$};
    \draw (L0) edge node[right] {$G$} (Lm);
    \draw (L0) edge node[auto] {$\langle{a}\rangle$} (Lpr);
    \draw (Lpr) edge node[auto] {$S$} (Lm);
\end{tikzpicture}
\end{center}
The coefficients of $\widehat{M}(T)$ being the symmetrical polynomial in the $\eta_i$, we
can see that the action of $\rho_a$ will simply permute the $\widehat{\eta_i}$
leaving the coefficients unchanged. Moreover, if you take a product of less than
$n$ factor of the form $(T - \widehat{\eta_i})$, the coefficients won't be fixed
by $\rho_a$, thus the polynomial is irreducible.

To finish the proof, we shall note that $\Theta$ is in $\mathcal{O}(L_0)$, then
by a classical result $\text{Tr}_{L_m/L'}(\Theta)$ is in $\mathcal{O}(L_0)$. By
applying again the same results, we deduce that all the coefficients of $\widehat{M}(T)$
are indeed in $\mathcal{O}(L_0)$.
\end{proof}

We are now going back to finite characteristic, $p\geq3$. Let
\begin{equation}
\mathcal{A}_0:=\F_q[X]/(\psi_{m,a}(X))
\end{equation}
and
\begin{equation}
\mathcal{A}:=\F_p[X]/(Y^2-(X^3+AX+B),\psi_{m,a}(X)).
\end{equation}
Let $\theta$ and $\gamma$ be the residue class of $X$ and $Y$ in $\mathcal{A}$.
We write $P = (\theta, \gamma)$ the generic point in the eigenspace of $a$. 
Like above, for $o\in(\Z/m\Z)^{\times}$ we define the unique polynomials 
$g_o\in\F_q$ of degree inferior to $(m-1)/2$ such that $g_a(\theta)= 
([a]P)_X \in\mathcal{A}$. We can then write 
\begin{equation}
\psi_{m,a}(Z) = \prod_{a=1}^{(m-1)/2}{(Z - g_a(\theta))}.
\end{equation}
We can summarize the situation with the following figure
\begin{center}
\begin{tikzpicture}
    \node (L) {$L$};
    \node[above = of L] (L0) {$L_0 = L[X]/(\Phi_{m}(X,j(\widehat{E})))$};
    \node[above left=0.2cm and 2cm of L0] (R0) {$R_0$};
    \node[right=4cm of L0] (Fq) {$\F_q$};
    \node[above= of L0] (Lpr) {$L' = L_0(\widehat{\eta}_0)$};
    \node[above= of Fq] (Fqa) {$\F_q(\eta_0)$};
    \node[above= of R0] (Rpr) {$R'$};
    \node[above= of Lpr] (Lm) {$L_m = L(E[m]) = L_0[X]/(\widehat{\psi}_{m,a}(X))$};
    \node[above= of Rpr] (Rm) {$R_m$};
    \node[above= of Fqa] (A0) {$\mathcal{A}_0 = \F_q(E[m])$};
    \draw (L) edge node[right] {$m+1$} (L0);
    \draw (L0) edge node[auto] {$2$} (R0);
    \draw (Lpr) edge node[auto] {$2$} (Rpr);
    \draw (Lm) edge node[auto] {$2$} (Rm);
    \draw (L0) edge node[right] {$n$} (Lpr);
    \draw (Lpr) edge node[right] {$(m-1)/2n$} (Lm);
    \draw (R0) edge node[auto] {} (Rpr);
    \draw (Rpr) edge node[auto] {} (Rm);
    \draw (Fq) edge node[right] {$\langle{a}\rangle$} (Fqa);
    \draw (Fqa) edge node[auto] {} (A0);
    \draw[->>] (L0) edge node[auto] {$\bmod \mathfrak{p}$} (Fq);
    \draw[->>] (Lpr) edge node[auto] {$\bmod \mathfrak{p}$} (Fqa);
    \draw[->>] (Lm) edge node[auto] {$\bmod \mathfrak{p}$} (A0);
\end{tikzpicture}
\end{center}
where $\Phi_m(X,j(\widehat{E}))$ is an equation of the modular curve $X_0(m)$.

We recall that, since $m$ is an Elkies prime for $E$ by definition, we can 
find a generator $c\in(\Z/m\Z)^{\times}$ such that $a = c^{n'}$ for 
$n'=(m-1)/(2n)$, and we have $S=\langle{s}\rangle$ with $s=c^n$. 
For $0\leq i<q$, we define 
\begin{equation}
\eta_i = \sum_{\sigma\in S}{g_{\sigma}(g_{a^i}(\theta))}
\end{equation}
reduction modulo $\mathfrak{p}$ of $\widehat{\eta}_i$. For $m\geq3$ odd, the
discriminant of $\psi_m$ satisfies the following relation
\begin{equation}
\text{Disc}(\psi_m) = (-1)^{(m-1)/2}m^{(m^2 - 3)/2}(-\Delta)^{(m^2 - 1)(m^2 -
3)/24}
\end{equation}
where $\Delta$ is the discriminant of $E$. From there we can assume that the
roots of $\psi_m$, and consequently the roots of $\psi_{m,a}$, are
distincts. Therefore, for $i\neq j$ we are assured that $\eta_i\neq\eta_j$ for
there would exists linear relation between the roots of $\psi_{m,a}$.

Then, we can deduce that the reduction of $\widehat{M}(T)$, the minimal
polynomial of $\widehat{\eta}_0$, is separated. As it was the case in
characteristic $0$, the action of $\langle{a}\rangle$ on the $\eta_i$ is cyclic,
as a direct consequence the $\eta_i$ are conjugates and $M(T)$ the reduction of
$\widehat{M}(T)$ is the minimal polynomial of $\eta_0 = \eta_a(P)$ and is of
degree $n$. This concludes the proof of the theorem.

\end{proof}

\begin{remark}
For $j=0,1728$ the results still hold. %TODO
\end{remark}

\subsection{Elliptic algorithm}

The main improvement of the elliptic variant of Rains' algorithm is the fact
that we can work directly in the extensions we are interested in. What allows
this to happen is that contrary to the roots of unity, there isn't only one
elliptic curve per extension, namely there are as many elliptic curves as there
are $j$-invariants in $\F_q$. Even more so, the use of twist of curves, which we
will be talking about later, ensures to almost always find the elliptic curve we
need for our algorithm.

The procedure is close to the cyclotomic variant's procedure. We first need to
generate the group we will be using, namely an elliptic curve, then we will
compute the elliptic periods in both extension using the definition given in the
previous section.

\subsubsection{Finding an elliptic curve}
If theoritically, we always introduce the elliptic curve before finding an
Elkies prime number, in practice, we have to find a prime $m$ which has the good
properties and then we pick an elliptic curve for which this $m$ is an Elkies
prime. We shall assume $p\neq2,3$.

We need to find an integer $m\neq p$ such that there exist an element of order $n$
modulo $m$. The first condition will be that $n|\varphi(m)$. We also need 
that the cofactor $\varphi(m)/n$ is prime with $n$, so it ensures that 
$(\Z/m\Z)^{\times}$ splits as we want, namely 
\begin{equation}
(\Z/m\Z)^{\times}/\Aut(E)=\langle{a}\rangle\times S \text{ or } 
(\Z/m\Z)^{\times}=\langle{a}\rangle\times S
\end{equation}
for $S$ a subgroup of $(\Z/m\Z)^{\times}$ and $a$ the eigenvalue of $\pi_q$ of
order $n$ modulo $m$. We also wish for $b$, the other eigenvalue of $\pi_q$ to
be of order not dividing $n$, so that the points of $E(\F_{q^n})$ of order $m$
are only in the eigenspace of $a$.

To pick a good elliptic curve, we shall first pick some trace candidate modulo 
$m$. Since we need $m$ to be an Elkies prime for the future elliptic curve, the
polynomial in $(\Z/m\Z)$ shall be of the form
\begin{equation}
(X - a)(X - b) = X^2 - (a + b)X + ab \bmod m.
\end{equation}
Then we pick $a\in(\Z/m\Z)^{\times}$ such that $\order_m(a) = n$ and,
since $ab = q$, we check that $\order_m(q/a)\not| n$. If these conditions are
met, we write $t = a + q/a \bmod m$ and check if it is a good trace candidate
using Hasse theorem. More precisely, we verify that $\widehat{t}$ the lift of $t$ is
actually in the Hasse's bound
\begin{equation}
|\widehat{t}| \leq 2\sqrt{q}.
\end{equation}\\

To chose the right elliptic curve, we pick a $j\in\F_q$ and compute
the traces of the associated elliptic curves to check if any of them
is equal to one of the candidates we picked previously. See
Appendix~\ref{app:elliptic-curves} for a way of determining at once
all the traces associated to a $j$-invariant.

In summary, we need to find an integer $m$ such that :
\begin{itemize}
    \item $m$ is prime,
    \item $n\mid\varphi(m)$ and $(\varphi(m)/n,n)=1$,
    \item there exists $a\in(\Z/m\Z)^{\times}$ such that 
\begin{equation}
\label{equation:ordeigen}
\order_m(a) = n,\order_m(\dfrac{q}{a}) \not| n\text{ and }|\widehat{a + \dfrac{q}{a}}| \leq 2\sqrt{q}.
\end{equation}
\end{itemize}
Let
\begin{equation}
\mathcal{T}_m = \lbrace{t = a + q/a \bmod m \text{ with } a\in(\Z/m\Z)^{\times}
\text{ such that } a \text{ satisfies 
}(\ref{equation:ordeigen})}\rbrace
\end{equation}
the good trace candidates for a prime $m$, then the routine to find a good 
elliptic curve is as follow.

\begin{algorithm}
    [Selecting an elliptic curve]
    \label{algorithm:selectell}
    \begin{algorithmic}[1]
    \REQUIRE $m$ an integer s.t. $\mathcal{T}_m\neq\O$, $\mathcal{T}_m$ 
    \ENSURE $E$ an elliptic curve with $t_E\in\mathcal{T}_m$
    \FOR{$j\in\F_q$}
        \STATE $E \leftarrow E(j_E = j)$ 
        \STATE $\mathcal{U} \leftarrow \mu_2, \mu_4\text{ or }\mu_6$ if 
$j_E\neq0,1728$, $j_E=1728$ or $j_E=0$ respectively.
            \FOR{$U\in\mathcal{U}$}
                \IF{$U.t_E\in\mathcal{T}_m$}
                    \RETURN Twist($E$, $U$)
                \ENDIF
            \ENDFOR
    \ENDFOR
    \end{algorithmic}
\end{algorithm}

\subsubsection{Computing the elliptic periods}

Computing the elliptic periods isn't the most complicated part of the algorithm.
Counting the points of $E/\F_{q^n}$ is directly deduced from the number of
points of $E/\F_q$ using the relation
\begin{equation}
\#E(\F_q^n)=q^n+1-(a^n+b^n)
\end{equation}
for $a, b$ the roots of the characteristic polynomial of $\pi_q$. To find a
point of order $m$ in the eigenspace of $a$, we just have to find a point of
order $m$ in $\F_{q^n}$ thanks to the properties on the order of the eigenvalue.
The procedure is straightforward, we pick a random point in $Q\in E(\F_{q^n})$
and we compute $P = [\#E(\F_{q^n})/m]Q$. If $Q\neq\mathcal{O}$ then $P$ is a
point of order exactly $m$ in the eigenspace of $a$, since $m$ is prime.
Depending on the $j$-invariant of $E$ the elliptic periods should be computed 
differently, see (\ref{definition:ellperiod}).
 
Practically, let $c\in(\Z/m\Z)^{\times}$ be a generator such that $s = c^n$ is 
of order $\varphi(m)/(2n)$ in $(\Z/m\Z)^{\times}/\Aut(E)$. Thus we define $S 
:= \langle{s}\rangle$, since $a$ is of order $n$ in $(\Z/m\Z)^{\times}$, we 
obtain the product we want
\[
(\Z/m\Z)^{\times}/\Aut(E) = \langle{a}\rangle\times\langle{s}\rangle
\]
Also, since all the groups are cyclic, we can rewrite the elliptic periods in a
more computable form, if we let $n_E = \#\Aut(E)$ then we have
\begin{equation}
\eta_a(P) = \sum_{i = 0}^{\varphi(m)/n_E.n}{\left([s^i]P\right)_X^{n_E/2}}.
\end{equation}
The function can be summarized as follow

\begin{algorithm}
[Computing the elliptic periods]
\label{algorithm:compell}
    \begin{algorithmic}[1]
    \REQUIRE $K$ a finite field with $q^n$ elements, $E/\F_q$ an elliptic curve
defined over $\F_q$, $m$ the parameter, $n_E = \#\Aut(E)$ an integer, $c$ a 
generator of $(\Z/m\Z)^{\times}$
    \ENSURE $\eta$ an elliptic period
    \STATE $\order_E\leftarrow\#E(K)$
    \STATE $\order_S \leftarrow \dfrac{\varphi(m)}{n_E.n}$
    \STATE $s \leftarrow c^n$
    \REPEAT
        \STATE $Q\leftarrow\text{rand}(E(K))$
        \STATE $P\leftarrow[\dfrac{\order_E}{m}]Q$
    \UNTIL{$P\neq\mathcal{O}$}
    \STATE $\eta\leftarrow\sum_{i=0}^{\order_S}{\left([s^i]P\right)_X^{n_E/2}}$
    \RETURN $\eta$
    \end{algorithmic}
\end{algorithm}

\subsubsection{Isomorphism algorithm}

We recall that $k_1\simeq\F_q[X]/(f)$ and $k_2\simeq\F_q[Y]/(g)$. Then using the
previous algorithms, we compute a period elliptic in each field extension. By
the theorem \ref{}, they define an isomorphism. Therefore we can state the
complete elliptic variants of Rains' algorithm.

\begin{algorithm}
[Elliptic variants of Rains' algorithm]
\label{algorithm:rainsell}
    \begin{algorithmic}[1]
    \REQUIRE $k_1$, $k_2$, $\F_q$
    \ENSURE $\eta_1\in k_1$, $\eta_2\in k_2$ two elements defining an
isomorphism
    \STATE Find $m$ s.t. $\mathcal{T}_m\neq\emptyset$
    \STATE Compute $g$ a generator of $\F_{q^n}^{\times}$
    \STATE Find $E$ using algorithm (\ref{algorithm:selectell})
    \STATE Compute $c$ a generator of $(\Z/m\Z)^{\times}$
    \STATE Compute $\eta_1$ in $k_1$ using algorithm (\ref{algorithm:compell})
    \STATE Compute $\eta_2$ in $k_2$ using algorithm (\ref{algorithm:compell})
    \RETURN $\eta_1, \eta_2$
    \end{algorithmic}
\end{algorithm}

\subsection{Complexity analysis}

\section{Experimental Results}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\part{Embedding evaluation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Algorithms specific to normal bases}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Monomial-dual bases pairs}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Experimental results}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Conclusion}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\appendix
\part*{Appendices}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Elliptic curves}
\label{app:elliptic-curves}

Recall that two elliptic curves $E$ and $E'$ over a field $k$ are said
to be \emph{isomorphic} if there exists a linear change of variables
with coefficients in $k$ sending one onto the other. If $E$ and $E'$
are isomorphic over $\bar{k}$, but not over $k$, they are said to be
\emph{twists} of each other. A twist is said to be quadratic
(resp. cubic, quartic, sextic), if $E$ and $E'$ become isomorphic over
a quadratic (resp. cubic, quartic, sextic) extension of $k$. Most
elliptic curves only have quadratic twists; elliptic curves with
$j=0,1728$ may have cubic, quartic and sextic twists. See~\cite{Sil}.

We now give a proposition relating the number of points of an elliptic
curve over a finite field with the number of points of its twists.  In
the case of quadratic twists, this proposition simply states that $E$
and $E'$ have opposite trace, a well known fact.

\begin{proposition}
  \label{proposition:twisttrace}
  Let $E$ be an ordinary elliptic curve defined over a finite field
  $\F_q$ of characteristic $p$, and denote by $t$ the trace of its
  frobenius endomorphism.

  Let $u\in\bar{\F}_q$ such that $u^{q-1}$ is in the prime field
  $\F_p\subset\F_q$. Define a curve $E^u$ and an isomorphism
  $\upsilon$ of elliptic curves by
  \begin{equation*}
    \begin{aligned}
      \upsilon : E &\to E^u,\\
      (x,y) &\mapsto (u^2x,u^3y).
    \end{aligned}
  \end{equation*}
  
  If $E^u$ is defined over $\F_q$, the trace $t_u$ of its frobenius
  endomorphism is such that $t/t_u=U\bmod q$, where
  \begin{enumerate}[a)]
  \item $U$ is an element of $\Z/q$ of the same multiplicative order
    as $u^{1-q}\in\F_q$, and
  \item $U=u^{1-q}\mod p$.
  \end{enumerate}
\end{proposition}
\begin{proof}
  Observe that if $E^u$ is a quadratic (resp. cubic, quartic, sextic)
  twist of $E$, then $u^{q-1}$ has multiplicative order $2$
  (resp. $3,4,6$). Furthermore, since $E$ is ordinary, $u^{q-1}$ is in
  the prime field $\F_p$ and it defines a curve automorphism
  \begin{equation*}
    \upsilon^{q-1}:(x,y)\mapsto(u^{2q-2}x,u^{3q-3}y).
  \end{equation*}
  Any twist arises this way (see~\cite{Sil}).

  Denote by $\pi$ and $\pi_u$ the frobenius endomorphisms of $E$
  and $E^u$ respectively. They satisfy the equations
  \begin{equation}
    \label{eq:frob-char-twist}
    \pi^2 - [t]\pi + [q] = 0, \qquad \pi_u^2 - [t_u]\pi_u + [q] = 0,
  \end{equation}
  where $[m]$ denotes multiplication by $m$ on the elliptic curves. By
  straightforward calculation, we also verify that they satisfy the
  commutative diagram
  \begin{equation*}
    \begin{tikzpicture}[node distance=3em]
      \node(E){$E$};
      \node[right of=E](E2){$E$};
      \node[right of=E2](E3){$E$};
      \node[below of=E](Eu){$E^u$};
      \node[right of=Eu](Eu2){$E^u$};
      \node[right of=Eu2](Eu3){$E^u$};

      \draw[->,auto,font=\scriptsize]
      (E) edge node[swap]{$\upsilon$} (Eu)
          edge node{$\pi$} (E2)
          edge[bend left=45] node{$[q]$} (E3)
      (Eu) edge node[swap]{$\pi_u$} (Eu2)
           edge[bend right=45] node[swap]{$[q]$} (Eu3)
      (E2) edge node[swap]{$\upsilon^q$} (Eu2)
           edge node{$\hat\pi$} (E3)
      (Eu2) edge node[swap]{$\hat\pi_u$} (Eu3)
      (E3) edge node{$\upsilon$} (Eu3);
    \end{tikzpicture}
  \end{equation*}
  where we denote by $\upsilon^q$ the isomorphism
  $(x,y)\mapsto(u^{2q}x,u^{3q}y)$, and by $\hat\pi,\hat\pi_u$ the dual isogenies
  to $\pi,\pi_u$.

  Now we restrict the maps above to the $q$-torsion subgroups of $E$
  and $E^u$. Since the curves are ordinary, these subgroups are cyclic
  of order $q$, and the maps act as scalar multiplication on the
  points. In particular, we deduce from Eq.~\eqref{eq:frob-char-twist} that 
  \begin{equation*}
    \pi = [t \bmod q], \qquad \pi_u = [t_u \bmod q].
  \end{equation*}
  Hence, from the diagram we obtain
  \begin{equation*}
    [t] = \upsilon^{-q}\circ[t_u]\circ\upsilon \mod q.
  \end{equation*}

  Notice that $\upsilon^{-q}$ can be decomposed as
  $\upsilon^{-1}\circ\upsilon^{1-q}$, where $\upsilon^{1-q}$ is an
  automorphism of $E^u$ by hypothesis. $\upsilon^{1-q}$ also acts on
  the $q$-torsion points as a scalar in $\Z/q$, that we shall denote
  by $U$. It is evident that the multiplicative order of $U$ in $\Z/q$
  is the same as that of $u^{1-q}$ in $\F_p$. Then
  \begin{equation*}
    [t] = \upsilon^{-1}\circ[Ut_u]\circ\upsilon.
  \end{equation*}
  But $\upsilon$ is an isomorphism, thus it commutes with scalar
  multiplication, and we conclude that $t=Ut_u\bmod q$.

  If $u^{1-q}=\pm1$, we are done. When the order of $u^{1-q}$ is $3,4$
  or $6$, we still have to determine which of the cubic, fourth, sixth
  roots of unity in $\Z/q$ corresponds to $U$.

  Using the diagram above, we decompose
  Eq.~\eqref{eq:frob-char-twist} as
  \begin{equation*}
    \hat\pi\circ\pi = [t]\pi - \pi^2,
  \end{equation*}
  and similarly for $E^u$. Hence, from the diagram again,
  \begin{equation*}
    [t] - \pi = \hat\pi = \upsilon^{-1}\circ\hat\pi_u\circ\upsilon^q 
    =  \upsilon^{-1}\circ([t_u] - \pi_u)\circ\upsilon^q.
  \end{equation*}
  Let now $\omega$ be the invariant differential of $E$. We have
  \begin{equation*}
    ([t]-\pi^2)^\ast\omega = t\omega\in\Omega_E
  \end{equation*}
  because $\pi$ is inserparable. On the other hand, if we let
  $\omega_u$ be the invariant differential of $E^u$, we have
  \begin{multline*}
    (\upsilon^{-1}\circ([t_u] - \pi_u)\circ\upsilon^q)^\ast\omega =
    (\upsilon^{-1}\circ([t_u] - \pi_u)\circ\upsilon^{q-1})^\ast\omega_u =\\
    (\upsilon^{-1}\circ([t_u] - \pi_u))^\ast u^{1-q}\omega_u =
    (\upsilon^{-1})^\ast t_uu^{1-q}\omega_u =
    t_uu^{1-q}\omega.
  \end{multline*}
  Hence $t = t_uu^{1-q} \bmod p$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\bibliographystyle{plain}
\bibliography{defeo}

\end{document}


% Local Variables:
% ispell-local-dictionary:"american"
% End:

%  LocalWords:  isomorphism
